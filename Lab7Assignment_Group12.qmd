---
title: "Lab7Assignment Group12"
format: 
  html:
    embed-resources: true
editor: visual
authors: "s132347 (Sofie Emilie Hagelund),<br>
          s253710 (Henrique Gomes),<br>
          s253689 (Paula Meerjanssen),<br>
          s252750 (Shuyue Zhang),<br>
          s253719 (Eszter Hudra)"
---

## Load Libraries

```{r}
#| message: false  

library(tidyverse) 
library(broom)  
library(cowplot)
library(ggrepel)
```

## Load Data

```{r}
biopsy <- read_csv(
  "https://wilkelab.org/classes/SDS348/data_sets/biopsy.csv",
  show_col_types = FALSE)
```

## PCA

```{r}
pca_fit <- biopsy %>% 
  select(where(is.numeric)) %>% 
  scale() %>% 
  prcomp() 
```

## Visualization

Below are a few graphs for visualization.

```{r}
pca_fit %>% 
  augment(biopsy) %>% 
  ggplot(
    aes(
      x = .fittedPC1, 
      y = .fittedPC2, 
      color = outcome
      )
    ) +
  geom_point(
    alpha = 0.7, 
    size = 1.0
    ) +
  labs(
    title = "Projection of Tumor Samples onto the First Two Principal Components"
  ) +
  theme_minimal() +
  theme(
    axis.line = element_line(),
    plot.title = element_text(face="bold")
    )
```

The graph contains sample data showing separation between benign (blue) and malignant (orange) outcomes. Each point represents one sample, positioned according to its scores on the first two Principal Components (PC1 and PC2). The x-axis represents the first Principle Component, and the y-axis represents the second Principle Component. Clustering of data indicates that the PCA captures meaningful variation related to the outcome type.

```{r}
arrow_style <- arrow(
  angle = 20,
  ends = "first",
  type = "closed",
  length = grid::unit(8,
                      "pt"
                      )
  )

pca_fit %>%
  tidy(matrix = "rotation") %>%
  pivot_wider(names_from = "PC",
              names_prefix = "PC",
              values_from = "value"
              ) %>%
  ggplot(aes(PC1, PC2)) +
  geom_segment(xend = 0,
               yend = 0,
               arrow = arrow_style
               ) +
  geom_text_repel(
    aes(label = column),
    nudge_x = -0.02,
    nudge_y = 0.01,
    hjust = 1, 
    color = "#663399",
    size = 2.75
  ) +
  xlim(-1.25, .5) + 
  ylim(-.5, 1) +
  coord_fixed() + 
  theme_minimal_grid(12) + 
  labs(
    title = "Variable Biplot (PC1 vs. PC2)"
  )
```

The above plot displays how the variables contribute to the first two Principle Components. Each arrow represents one variable. The direction of the arrows shows how the variable correlates with the components and the length of the arrows show how strongly that variable correlates with the variables.

```{r}
pca_fit %>%
  tidy(matrix = "eigenvalues") %>%
  ggplot(aes(PC,
             percent)
         ) +
  geom_col(fill = "#56B4E9",
           alpha = 0.8
           ) +
  scale_x_continuous(breaks = 1:9) +
  scale_y_continuous(
    labels = scales::percent_format(),
    expand = expansion(mult = c(0, 0.01))
  ) +
  theme_minimal_hgrid(12) +
  labs(
    title = "Variance of Principle Components"
  )
```

The bar plot shows the percentage of variance captured by each Principal Component. The x-axis represents the components, and the y-axis indicates the percentage of the variance. The PC1 is about 65% of the total variance, followed by PC2 with about 9%. This means that most of the data can be summarised using the first two components.
